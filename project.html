<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project — JnanaDesigns</title>
  <meta name="description" content="Project detail page for JnanaDesigns portfolio" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&family=Playfair+Display:ital,wght@0,400;0,500;1,500&display=swap">

  <style>
    :root{
      --maxw:980px; --bg:#fbfbfb; --muted:#666; --accent:#0b66ff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{margin:0;background:var(--bg);color:#111;font-size:16px;line-height:1.6}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    a { color: var(--accent) }
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    header h1{margin:0;font-family:"Poppins",sans-serif;font-size:18px}
    .back{font-size:14px;padding:8px 10px;border-radius:8px;border:1px solid #e9e9e9;background:#fff;text-decoration:none;color:inherit}
    .title{font-family:"Playfair Display",serif;font-size:26px;margin:10px 0}
    .meta{color:var(--muted);font-size:14px;margin-bottom:14px}

    .images{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px}
    .images img{width:100%;height:auto;border-radius:8px;object-fit:cover;border:1px solid #eee}

    .content{
      background:#fff;padding:18px;border-radius:8px;border:1px solid #eee;
      font-size:16px;line-height:1.6;
    }

    /* Improve readability of GitHub-rendered HTML */
    .content h1,.content h2,.content h3{
      font-family:"Playfair Display",serif;
      margin-top:1.2em;
    }
    .content p{margin:0.6em 0;}
    .content ul, .content ol{
      padding-left:20px;
      margin:0.6em 0;
    }
    .content img{max-width:100%;border-radius:8px;margin:10px 0;border:1px solid #eee}

    .labels{margin-top:10px;color:var(--muted);font-size:13px}
    .spinner{color:var(--muted);font-size:15px}
  </style>
</head>

<body>
  <div class="wrap" id="app">
    <header>
      <a class="back" href="./">← Back</a>
      <h1>Project</h1>
    </header>

    <div id="main">
      <p id="loading" class="spinner">Loading project…</p>
    </div>
  </div>

<script>
(async function(){
  const OWNER = 'apoorvaj192';
  const REPO  = 'jnanadesigns';

  const params = new URLSearchParams(window.location.search);
  const issueNumber = params.get('issue');
  const target = document.getElementById('main');
  const loading = document.getElementById('loading');

  if(!issueNumber){
    target.innerHTML = '<p style="color:#c33">No project specified. Please return to the homepage.</p>';
    return;
  }

  // Fetch Issue
  async function fetchIssue(){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/issues/${issueNumber}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Issue fetch failed: ' + res.status);
    return res.json();
  }

  // Send Markdown to GitHub's renderer
  async function renderMarkdown(md){
    const mdApi = "https://api.github.com/markdown";
    const body = {
      text: md,
      mode: "gfm",
      context: `${OWNER}/${REPO}`
    };
    const res = await fetch(mdApi, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    if(!res.ok) throw new Error('Markdown render failed: ' + res.status);
    return res.text(); // rendered HTML
  }

  try {
    const issue = await fetchIssue();

    const title = issue.title || 'Untitled';
    const labels = (issue.labels || []).map(l => l.name).join(', ');
    const created = new Date(issue.created_at).toLocaleDateString();

    // Extract image URLs
    const imgRegex = /!\[.*?\]\((https?:\/\/[^\s)]+)\)/gi;
    const images = [...issue.body.matchAll(imgRegex)].map(x => x[1]);

    // Remove image markdown from main body before rendering
    const mdForHtml = issue.body.replace(imgRegex, '');

    // Render markdown fully
    const htmlBody = await renderMarkdown(mdForHtml);

    // Build HTML
    let html = `
      <div class="title">${escapeHtml(title)}</div>
      <div class="meta">${created} ${labels ? " • " + escapeHtml(labels) : ""}</div>
    `;

    if(images.length){
      html += `<div class="images">` +
              images.map(url => `<img src="${url}" alt="Project image">`).join('') +
              `</div>`;
    }

    html += `<div class="content">${htmlBody}</div>`;

    target.innerHTML = html;

  } catch(err){
    console.error(err);
    target.innerHTML = `<p style="color:#c33">Error loading project. You can view it on GitHub: 
      <a href="https://github.com/${OWNER}/${REPO}/issues/${issueNumber}" target="_blank">Open Issue</a></p>`;
  }

  function escapeHtml(s){
    return String(s).replace(/&/g,'&amp;')
                    .replace(/</g,'&lt;')
                    .replace(/>/g,'&gt;');
  }

})();
</script>
</body>
</html>
